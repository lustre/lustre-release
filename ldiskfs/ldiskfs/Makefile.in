default: all

MODULES := ldiskfs

@QUOTA_TRUE@MODULES += quotafmt_test

# copy makefile over to not break patches
ext3_extra := $(wildcard @LINUX@/fs/ext3/Makefile)

ext3_headers := $(wildcard @LINUX@/fs/ext3/*.h)
linux_headers := $(wildcard @LINUX@/include/linux/ext3*.h)

ext3_sources := $(filter-out %.mod.c,$(wildcard @LINUX@/fs/ext3/*.c))
new_sources := iopen.c iopen.h extents.c mballoc.c \
               iam.c iam_lfix.c iam_lvar.c iam_htree.c iam-uapi.c
new_headers := ext3_extents.h
ldiskfs_patched_sources := $(notdir $(ext3_sources) $(ext3_headers)) $(new_sources) $(new_headers)
ldiskfs_sources := $(ldiskfs_patched_sources)

quotafmt_sources := lustre_quota_fmt.c
quotafmt_headers := lustre_quota_fmt.h
@QUOTA_TRUE@ldiskfs_sources += $(quotafmt_sources) $(quotafmt_headers)

ldiskfs-objs := $(filter %.o,$(ldiskfs_sources:.c=.o))

@QUOTA_TRUE@quotafmt-objs := quotafmt_test.o

EXTRA_PRE_CFLAGS := -I@LINUX@/fs -I@LUSTRE@ -I@LUSTRE@/ldiskfs

@INCLUDE_RULES@
