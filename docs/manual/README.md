# Lustre Operations Manual

This directory contains the source files for the Lustre Operations Manual,
written in DocBook 5 XML format.

## History

This manual was imported from the separate Lustre manual repository on
2025-01-04 using `git subtree add`, preserving the full commit history.

**Original repository:** `https://review.whamcloud.com/doc/manual.git`

The original repository is now archived. All future manual development
should happen in this integrated location.

## Building the Manual

The manual build is **optional** and not part of the default build. It
requires the DocBook toolchain and additional dependencies.

### Enabling the Manual Build

To enable manual building, pass `--with-manual` to configure:

```bash
./configure --with-manual [other options...]
```

If dependencies are missing, configure will fail with an error message
indicating which package needs to be installed.

### Build Dependencies

The following tools are required:

| Tool | Purpose | Debian/Ubuntu | RHEL/CentOS/Fedora |
|------|---------|---------------|-------------------|
| xmllint | XML validation | `libxml2-utils` | `libxml2` |
| xsltproc | XSLT processing | `xsltproc` | `libxslt` |
| fop | PDF generation | `fop` | `fop` |
| pandoc | Markdown generation | `pandoc` | `pandoc` |

Additionally, DocBook 5 schemas and stylesheets are required:

| Component | Debian/Ubuntu | RHEL/CentOS/Fedora |
|-----------|---------------|-------------------|
| DocBook 5 XML schemas | `docbook5-xml` | `docbook5-schemas` |
| DocBook XSL-NS stylesheets | `docbook-xsl-ns` | `docbook-style-xsl` |

#### Quick Install

**Debian/Ubuntu:**
```bash
sudo apt-get install libxml2-utils xsltproc fop pandoc \
    docbook5-xml docbook-xsl-ns
```

**RHEL/CentOS/Fedora:**
```bash
sudo dnf install libxml2 libxslt fop pandoc \
    docbook5-schemas docbook-style-xsl
```

### Building

After configuring with `--with-manual`, build the manual with:

```bash
make manual
```

This will produce all output formats (PDF, HTML, Markdown).

You can also build specific formats by running make in the manual
directory:

```bash
cd docs/manual
make pdf        # PDF only
make html       # Single-page HTML
make xhtml      # Single-page XHTML
make chunked-html  # Multi-page HTML
make markdown   # Markdown (for AI consumption)
```

### Build Outputs

All build outputs are placed in `docs/manual/build/`:

| Output | Location | Description |
|--------|----------|-------------|
| PDF | `build/lustre_manual.pdf` | Print-ready PDF |
| HTML | `build/lustre_manual.html` | Single-page HTML |
| XHTML | `build/lustre_manual.xhtml` | Single-page XHTML |
| Chunked HTML | `build/chunked-html/` | Multi-page HTML |
| Markdown | `build/markdown/` | Chapter Markdown files |

The Markdown output is intended for AI agent consumption and may have
minor formatting imperfections from the automated DocBook conversion.

## Important Notes

- **Not installed:** The manual is a build product only. It is NOT
  installed by `make install`.

- **Not in default build:** The manual build is opt-in only. Running
  `make` without `--with-manual` configured will not build the manual.

- **Dependencies optional:** If you don't need to build the manual,
  you don't need to install any of the DocBook dependencies.

## Committed Markdown Files

The `markdown/` subdirectory contains Markdown versions of each manual
chapter, committed to the repository for easy access by AI agents and
other tools. These files are automatically regenerated by a pre-commit
hook whenever the DocBook XML source files are modified.

## Source Format

The manual source is DocBook 5 XML. Key files:

- `index.xml` - Main document that includes all chapters
- `*.xml` - Individual chapter files
- `figures/` - Images used in the manual
- `style/` - Custom XSL stylesheets for output formatting

## Contributing

### Requirements for Manual Contributors

Contributors who modify the manual source files (*.xml) **must have
pandoc installed**. The pre-commit hook will automatically regenerate
Markdown files when XML files are staged for commit. If pandoc is not
installed, the commit will fail with an error message.

Contributors who never touch the manual do not need pandoc.

**Install pandoc:**
```bash
# Debian/Ubuntu
sudo apt-get install pandoc

# RHEL/CentOS/Fedora
sudo dnf install pandoc

# macOS
brew install pandoc
```

### Modifying the Manual

1. Install the pre-commit hook:
   ```bash
   cp contrib/git-hooks/pre-commit .git/hooks/
   chmod +x .git/hooks/pre-commit
   ```

2. Edit the relevant XML files

3. Validate changes (optional, requires full DocBook toolchain):
   ```bash
   make check  # in docs/manual directory
   ```

4. Commit your changes - the pre-commit hook will automatically
   regenerate the Markdown files and stage them

5. Submit changes through the normal Lustre contribution process

For DocBook 5 documentation, see:
https://tdg.docbook.org/tdg/5.0/docbook.html
