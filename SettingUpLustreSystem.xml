<?xml version="1.0" encoding="UTF-8"?>
<chapter version="5.0" xml:lang="en-US" xmlns="http://docbook.org/ns/docbook" xmlns:xl="http://www.w3.org/1999/xlink" xml:id='settinguplustresystem'>
  <info>
    <title xml:id='settinguplustresystem.title'>Setting Up a Lustre File System</title>
  </info>
  <para><anchor xml:id="dbdoclet.50438256_pgfId-1290293" xreflabel=""/>This chapter describes hardware configuration requirements for a Lustre file system including:</para>


  <itemizedlist>
  <listitem>
      <para>
          <link linkend='dbdoclet.50438256_49017'/>
      </para>
  </listitem>
  <listitem>
      <para>
          <link linkend='dbdoclet.50438256_31079'/>
      </para>
  </listitem>
  <listitem>
      <para>
          <link linkend='dbdoclet.50438256_84701'/>
      </para>
  </listitem>
  <listitem>
      <para>
          <link linkend='dbdoclet.50438256_26456'/>
      </para>
  </listitem>
  <listitem>
      <para>
          <link linkend='dbdoclet.50438256_78272'/>
      </para>
  </listitem>
  </itemizedlist>



    <section xml:id="dbdoclet.50438256_49017">
      <title>5.1 Hardware Considerations</title>
      <para><anchor xml:id="dbdoclet.50438256_pgfId-1292812" xreflabel=""/>Lustre can work with any kind of block storage device such as single disks, software RAID, hardware RAID, or a logical volume manager. In contrast to some networked file systems, the block devices are only attached to the MDS and OSS nodes in Lustre and are not accessed by the clients directly.</para>
      <para><anchor xml:id="dbdoclet.50438256_pgfId-1292817" xreflabel=""/>Since the block devices are accessed by only one or two server nodes, a storage area network (SAN) that is accessible from all the servers is not required. Expensive switches are not needed because point-to-point connections between the servers and the storage arrays normally provide the simplest and best attachments. (If failover capability is desired, the storage must be attached to multiple servers.)</para>
      <para><anchor xml:id="dbdoclet.50438256_pgfId-1290297" xreflabel=""/>For a production environment, it is preferable that the MGS have separate storage to allow future expansion to multiple file systems. However, it is possible to run the MDS and MGS on the same machine and have them share the same storage device.</para>
      <para><anchor xml:id="dbdoclet.50438256_pgfId-1292437" xreflabel=""/>For best performance in a production environment, dedicated clients are required. For a non-production Lustre environment or for testing, a Lustre client and server can run on the same machine. However, dedicated clients are the only supported configuration.</para>
      <para><anchor xml:id="dbdoclet.50438256_pgfId-1292435" xreflabel=""/>Performance and other issues can occur when an MDS or OSS and a client are running on the same machine:</para>
      <itemizedlist><listitem>
          <para><anchor xml:id="dbdoclet.50438256_pgfId-1292457" xreflabel=""/> Running the MDS and a client on the same machine can cause recovery and deadlock issues and impact the performance of other Lustre clients.</para>
        </listitem>
<listitem>
          <para> </para>
        </listitem>
<listitem>
          <para><anchor xml:id="dbdoclet.50438256_pgfId-1292461" xreflabel=""/> Running the OSS and a client on the same machine can cause issues with low memory and memory pressure. If the client consumes all the memory and then tries to write data to the file system, the OSS will need to allocate pages to receive data from the client but will not be able to perform this operation due to low memory. This can cause the client to hang.</para>
        </listitem>
<listitem>
          <para> </para>
        </listitem>
</itemizedlist>
      <para><anchor xml:id="dbdoclet.50438256_pgfId-1292132" xreflabel=""/>Only servers running on 64-bit CPUs are tested and supported. 64-bit CPU clients are typically used for testing to match expected customer usage and avoid limitations due to the 4 GB limit for RAM size, 1 GB low-memory limitation, and 16 TB file size limit of 32-bit CPUs. Also, due to kernel API limitations, performing backups of Lustre 2.x. filesystems on 32-bit clients may cause backup tools to confuse files that have the same 32-bit inode number.</para>
      <para><anchor xml:id="dbdoclet.50438256_pgfId-1292472" xreflabel=""/>The storage attached to the servers typically uses RAID to provide fault tolerance and can optionally be organized with logical volume management (LVM). It is then formatted by Lustre as a file system. Lustre OSS and MDS servers read, write and modify data in the format imposed by the file system.</para>
      <para><anchor xml:id="dbdoclet.50438256_pgfId-1292545" xreflabel=""/>Lustre uses journaling file system technology on both the MDTs and OSTs. For a MDT, as much as a 20 percent performance gain can be obtained by placing the journal on a separate device.</para>
      <para><anchor xml:id="dbdoclet.50438256_pgfId-1292546" xreflabel=""/>The MDS can effectively utilize a lot of CPU cycles. A minimium of four processor cores are recommended. More are advisable for files systems with many clients.</para>
      <note>
      <para>Lustre clients running on architectures with different endianness are supported. One limitation is that the PAGE_SIZE kernel macro on the client must be as large as the PAGE_SIZE of the server. In particular, ia64 or PPC clients with large pages (up to 64kB pages) can run with x86 servers (4kB pages). If you are running x86 clients with ia64 or PPC servers, you must compile the ia64 kernel with a 4kB PAGE_SIZE (so the server page size is not larger than the client page size). <anchor xml:id="dbdoclet.50438256_51943" xreflabel=""/></para>
  </note>

      <section remap="h3">
        <title><anchor xml:id="dbdoclet.50438256_pgfId-1293428" xreflabel=""/>5.1.1 MDT Storage Hardware Considerations</title>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1293438" xreflabel=""/>The data access pattern for MDS storage is a database-like access pattern with many seeks and read-and-writes of small amounts of data. High throughput to MDS storage is not important. Storage types that provide much lower seek times, such as high-RPM SAS or SSD drives can be used for the MDT.</para>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1295314" xreflabel=""/>For maximum performance, the MDT should be configured as RAID1 with an internal journal and two disks from different controllers.</para>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1295315" xreflabel=""/>If you need a larger MDT, create multiple RAID1 devices from pairs of disks, and then make a RAID0 array of the RAID1 devices. This ensures maximum reliability because multiple disk failures only have a small chance of hitting both disks in the same RAID1 device.</para>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1295316" xreflabel=""/>Doing the opposite (RAID1 of a pair of RAID0 devices) has a 50% chance that even two disk failures can cause the loss of the whole MDT device. The first failure disables an entire half of the mirror and the second failure has a 50% chance of disabling the remaining mirror.</para>
      </section>
      <section remap="h3">
        <title><anchor xml:id="dbdoclet.50438256_pgfId-1295312" xreflabel=""/>5.1.2 OST Storage Hardware Considerations</title>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1293429" xreflabel=""/>The data access pattern for the OSS storage is a streaming I/O pattern that is dependent on the access patterns of applications being used. Each OSS can manage multiple object storage targets (OSTs), one for each volume with I/O traffic load-balanced between servers and targets. An OSS should be configured to have a balance between the network bandwidth and the attached storage bandwidth to prevent bottlenecks in the I/O path. Depending on the server hardware, an OSS typically serves between 2 and 8 targets, with each target up to 16 terabytes (TBs) in size.</para>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1293431" xreflabel=""/>Lustre file system capacity is the sum of the capacities provided by the targets. For example, 64 OSSs, each with two 8 TB targets, provide a file system with a capacity of nearly 1 PB. If each OST uses ten 1 TB SATA disks (8 data disks plus 2 parity disks in a RAID 6 configuration), it may be possible to get 50 MB/sec from each drive, providing up to 400 MB/sec of disk bandwidth per OST. If this system is used as storage backend with a system network like InfiniBand that provides a similar bandwidth, then each OSS could provide 800 MB/sec of end-to-end I/O throughput. (Although the architectural constraints described here are simple, in practice it takes careful hardware selection, benchmarking and integration to obtain such results.)</para>
      </section>
    </section>
    <section xml:id="dbdoclet.50438256_31079" >
      <title>5.2 Determining Space Requirements</title>
      <para><anchor xml:id="dbdoclet.50438256_pgfId-1293293" xreflabel=""/>The desired performance characteristics of the backing file systems on the MDT and OSTs are independent of one another. The size of the MDT backing file system depends on the number of inodes needed in the total Lustre file system, while the aggregate OST space depends on the total amount of data stored on the file system.</para>
      <para><anchor xml:id="dbdoclet.50438256_pgfId-1293404" xreflabel=""/>Each time a file is created on a Lustre file system, it consumes one inode on the MDT and one inode for each OST object over which the file is striped. Normally, each fileâ€™s stripe count is based on the system-wide default stripe count. However, this can be changed for individual files using the lfssetstripe option. For more details, see <xref linkend='managingstripingfreespace'/>.</para>
      <para><anchor xml:id="dbdoclet.50438256_pgfId-1293400" xreflabel=""/>In a Lustre ldiskfs file system, all the inodes are allocated on the MDT and OSTs when the file system is first formatted. The total number of inodes on a formatted MDT or OST cannot be easily changed, although it is possible to add OSTs with additional space and corresponding inodes. Thus, the number of inodes created at format time should be generous enough to anticipate future expansion.</para>
      <para><anchor xml:id="dbdoclet.50438256_pgfId-1293818" xreflabel=""/>When the file system is in use and a file is created, the metadata associated with that file is stored in one of the pre-allocated inodes and does not consume any of the free space used to store file data.</para>
      <note>
<para>By default, the ldiskfs file system used by Lustre servers to store user-data objects and system data reserves 5% of space that cannot be used by Lustre. Additionally, Lustre reserves up to 400 MB on each OST for journal use and a small amount of space outside the journal to store accounting data for Lustre. This reserved space is unusable for general storage. Thus, at least 400 MB of space is used on each OST before any file object data is saved.<anchor xml:id="dbdoclet.50438256_74070" xreflabel=""/></para>
</note>

      <section remap="h3">
        <title><anchor xml:id="dbdoclet.50438256_pgfId-1292700" xreflabel=""/>5.2.1 <anchor xml:id="dbdoclet.50438256_87676" xreflabel=""/>Determining MDS/MDT Space Requirements</title>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1293355" xreflabel=""/>When calculating the MDT size, the important factor to consider is the number of files to be stored in the file system. This determines the number of inodes needed, which drives the MDT sizing. To be on the safe side, plan for 4 KB per inode on the MDT, which is the default value. Attached storage required for Lustre metadata is typically 1-2 percent of the file system capacity depending upon file size.</para>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1293134" xreflabel=""/>For example, if the average file size is 5 MB and you have 100 TB of usable OST space, then you can calculate the minimum number of inodes as follows:</para>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1293526" xreflabel=""/>(100 TB * 1024 GB/TB * 1024 MB/GB) / 5 MB/inode = 20 million inodes</para>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1293527" xreflabel=""/>We recommend that you use at least twice the minimum number of inodes to allow for future expansion and allow for an average file size smaller than expected. Thus, the required space is:</para>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1293545" xreflabel=""/>4 KB/inode * 40 million inodes = 160 GB</para>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1293135" xreflabel=""/>If the average file size is small, 4 KB for example, Lustre is not very efficient as the MDT uses as much space as the OSTs. However, this is not a common configuration for Lustre.</para>
        <note>
<para><emphasis role="bold">Note -</emphasis><anchor xml:id="dbdoclet.50438256_pgfId-1293142" xreflabel=""/>If the MDT is too small, this can cause all the space on the OSTs to be unusable. Be sure to determine the appropriate size of the MDT needed to support the file system before formatting the file system. It is difficult to increase the number of inodes after the file system is formatted.</para>
</note>
      </section>

      <section remap="h3">
        <title><anchor xml:id="dbdoclet.50438256_pgfId-1293490" xreflabel=""/>5.2.2 Determining OSS/OST Space Requirements</title>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1293491" xreflabel=""/>For the OST, the amount of space taken by each object depends on the usage pattern of the users/applications running on the system. Lustre defaults to a conservative estimate for the object size (16 KB per object). If you are confident that the average file size for your applications will be larger than this, you can specify a larger average file size (fewer total inodes) to reduce file system overhead and minimize file system check time. See <xref linkend="dbdoclet.50438256_53886"/> for more details.</para>
      </section>
    </section>
    <section xml:id="dbdoclet.50438256_84701" >
      <title>5.3 Setting File System Formatting Options</title>
      <para><anchor xml:id="dbdoclet.50438256_pgfId-1293227" xreflabel=""/>To override the default formatting options for any of the Lustre backing file systems, use this argument to mkfs.lustre to pass formatting options to the backing mkfs:</para>
      <screen><anchor xml:id="dbdoclet.50438256_pgfId-1293982" xreflabel=""/>--mkfsoptions=&apos;backing fs options&apos;</screen>
      <para><anchor xml:id="dbdoclet.50438256_pgfId-1293480" xreflabel=""/>For other options to format backing ldiskfs filesystems, see the Linux man page for mke2fs(8).</para>
      <section remap="h3">
        <title><anchor xml:id="dbdoclet.50438256_pgfId-1293228" xreflabel=""/>5.3.1 Setting the Number of Inodes for the MDS</title>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1294133" xreflabel=""/>The number of inodes on the MDT is determined at format time based on the total size of the file system to be created. The default MDT inode ratio is one inode for every 4096 bytes of file system space. To override the inode ratio, use the following option:</para>
        <screen><anchor xml:id="dbdoclet.50438256_pgfId-1294002" xreflabel=""/>-i <emphasis>&lt;bytes per inode&gt;</emphasis></screen>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1294004" xreflabel=""/>For example, use the following option to create one inode per 2048 bytes of file system space.</para>
        <screen><anchor xml:id="dbdoclet.50438256_pgfId-1294011" xreflabel=""/>--mkfsoptions=&quot;-i 2048&quot; 
</screen>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1294027" xreflabel=""/>To avoid mke2fs creating an unusable file system, do not specify the -i option with an inode ratio below one inode per 1024 bytes. Instead, specify an absolute number of inodes, using this option:</para>
        <screen><anchor xml:id="dbdoclet.50438256_pgfId-1294044" xreflabel=""/>-N<emphasis>&lt;number of inodes&gt;</emphasis></screen>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1293230" xreflabel=""/>For example, by default, a 2 TB MDT will have 512M inodes. The largest currently-supported file system size is 16 TB, which would hold 4B inodes, the maximum possible number of inodes in a ldiskfs file system. With an MDS inode ratio of 1024 bytes per inode, a 2 TB MDT would hold 2B inodes, and a 4 TB MDT would hold 4B inodes.</para>
      </section>
      <section remap="h3">
        <title><anchor xml:id="dbdoclet.50438256_pgfId-1294109" xreflabel=""/>5.3.2 <anchor xml:id="dbdoclet.50438256_34593" xreflabel=""/>Setting the Inode Size for the <anchor xml:id="dbdoclet.50438256_marker-1293231" xreflabel=""/>MDT</title>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1293233" xreflabel=""/>Lustre uses &quot;large&quot; inodes on backing file systems to efficiently store Lustre metadata with each file. On the MDT, each inode is at least 512 bytes in size (by default), while on the OST each inode is 256 bytes in size.</para>
        <para> The backing ldiskfs file system also needs sufficient space for other metadata like the journal (up to 400 MB), bitmaps and directories and a few files that Lustre uses to maintain cluster consistency.</para>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1293234" xreflabel=""/>To specify a larger inode size, use the -I &lt;inodesize&gt; option. We recommend you do NOT specify a smaller-than-default inode size, as this can lead to serious performance problems; and you cannot change this parameter after formatting the file system. The inode ratio must always be larger than the inode size.</para>
      </section>
      <section remap="h3">
        <title><anchor xml:id="dbdoclet.50438256_pgfId-1293236" xreflabel=""/>5.3.3 <anchor xml:id="dbdoclet.50438256_53886" xreflabel=""/>Setting the Number of Inodes for an <anchor xml:id="dbdoclet.50438256_marker-1293235" xreflabel=""/>OST</title>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1293237" xreflabel=""/>When formatting OST file systems, it is normally advantageous to take local file system usage into account. Try to minimize the number of inodes on each OST, while keeping enough margin for potential variance in future usage. This helps reduce the format and file system check time, and makes more space available for data.</para>
        <para> The current default is to create one inode per 16 KB of space in the OST file system, but in many environments, this is far too many inodes for the average file size. As a good rule of thumb, the OSTs should have at least:</para>
        <screen><anchor xml:id="dbdoclet.50438256_pgfId-1293238" xreflabel=""/>num_ost_inodes = <anchor xml:id="dbdoclet.50438256_pgfId-1294224" xreflabel=""/>4 * <emphasis>&lt;num_mds_inodes&gt;</emphasis> * <emphasis>&lt;default_stripe_count&gt;</emphasis> / <emphasis>&lt;number_osts&gt;</emphasis></screen>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1293239" xreflabel=""/>You can specify the number of inodes on the OST file systems using the following option to the --mkfsoption:</para>
        <screen><anchor xml:id="dbdoclet.50438256_pgfId-1294232" xreflabel=""/>-N <emphasis>&lt;num_inodes&gt;</emphasis></screen>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1294248" xreflabel=""/></para>
        <para> Alternately, if you know the average file size, then you can specify the OST inode count for the OST file systems using:</para>
        <screen><anchor xml:id="dbdoclet.50438256_pgfId-1294260" xreflabel=""/>-i <emphasis>&lt;average_file_size</emphasis> / (<emphasis>number_of_stripes</emphasis> * 4)<emphasis>&gt;</emphasis></screen>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1294261" xreflabel=""/>For example, if the average file size is 16 MB and there are, by default 4 stripes per file, then --mkfsoptions=&apos;-i 1048576&apos; would be appropriate.</para>
        <note>
<para>In addition to the number of inodes, file system check time on OSTs is affected by a number of other variables: size of the file system, number of allocated blocks, distribution of allocated blocks on the disk, disk speed, CPU speed, and amount of RAM on the server. Reasonable file system check times (without serious file system problems), are expected to take five and thirty minutes per TB.</para>
</note>

        <para><anchor xml:id="dbdoclet.50438256_pgfId-1293243" xreflabel=""/>For more details on formatting MDT and OST file systems, see <xref linkend='dbdoclet.50438208_51921'/>.</para>
      </section>
      <section remap="h3">
        <title><anchor xml:id="dbdoclet.50438256_pgfId-1290698" xreflabel=""/>5.3.4 File and File System Limits</title>
        <para><xref linkend='settinguplustresystem.tab1'/> describes file and file system size limits. These limits are imposed by either the Lustre architecture or the Linux virtual file system (VFS) and virtual memory subsystems. In a few cases, a limit is defined within the code and can be changed by re-compiling Lustre (see <xref linkend='installinglustrefromsourcecode'/><link xl:href="InstallingLustrefrSourceCode.html#50438210_75891">Chapter 29 : Installing Lustre from Source Code</link>). In these cases, the indicated limit was used for Lustre testing. </para>

         <table frame="all">
          <title xml:id='settinguplustresystem.tab1'>File and file system limits</title>
          <tgroup cols="3">
            <colspec colname="c1" colwidth="3*"/>
            <colspec colname="c2" colwidth="2*"/>
            <colspec colname="c3" colwidth="4*"/>
            <thead>
              <row>
                <entry><para><emphasis role="bold"><anchor xml:id="dbdoclet.50438256_pgfId-1290708" xreflabel=""/>Limit</emphasis></para></entry>
                <entry><para><emphasis role="bold"><anchor xml:id="dbdoclet.50438256_pgfId-1290710" xreflabel=""/>Value</emphasis></para></entry>
                <entry><para><emphasis role="bold"><anchor xml:id="dbdoclet.50438256_pgfId-1290712" xreflabel=""/>Description</emphasis></para></entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290715" xreflabel=""/>Maximum <anchor xml:id="dbdoclet.50438256_marker-1290714" xreflabel=""/>stripe count</para></entry>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290718" xreflabel=""/>160</para></entry>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290720" xreflabel=""/>This limit is hard-coded, but is near the upper limit imposed by the underlying ldiskfs file system.</para></entry>
              </row>
              <row>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290723" xreflabel=""/>Maximum <anchor xml:id="dbdoclet.50438256_marker-1290722" xreflabel=""/>stripe size</para></entry>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290726" xreflabel=""/>&lt; 4 GB</para></entry>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290728" xreflabel=""/>The amount of data written to each object before moving on to next object.</para></entry>
              </row>
              <row>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290731" xreflabel=""/>Minimum <anchor xml:id="dbdoclet.50438256_marker-1290730" xreflabel=""/>stripe size</para></entry>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290734" xreflabel=""/>64 KB</para></entry>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290736" xreflabel=""/>Due to the 64 KB PAGE_SIZE on some 64-bit machines, the minimum stripe size is set to 64 KB.</para></entry>
              </row>
              <row>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1294306" xreflabel=""/>Maximum object size</para></entry>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1294308" xreflabel=""/>2 TB</para></entry>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1294310" xreflabel=""/>The amount of data that can be stored in a single object. The ldiskfs limit of 2TB for a single file applies. Lustre allows 160 stripes of 2 TB each.</para></entry>
              </row>
              <row>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290739" xreflabel=""/>Maximum <anchor xml:id="dbdoclet.50438256_marker-1290738" xreflabel=""/>number of OSTs</para></entry>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290741" xreflabel=""/>8150</para></entry>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290743" xreflabel=""/>The maximum number of OSTs is a constant that can be changed at compile time. Lustre has been tested with up to 4000 OSTs.</para></entry>
              </row>
              <row>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1291931" xreflabel=""/>Maximum number of MDTs</para></entry>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1291933" xreflabel=""/>1</para></entry>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1291935" xreflabel=""/>Maximum of 1 MDT per file system, but a single MDS can host multiple MDTs, each one for a separate file system.</para></entry>
              </row>
              <row>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290747" xreflabel=""/>Maximum <anchor xml:id="dbdoclet.50438256_marker-1290746" xreflabel=""/>number of clients</para></entry>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290749" xreflabel=""/>131072</para></entry>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290751" xreflabel=""/>The number of clients is a constant that can be changed at compile time.</para></entry>
              </row>
              <row>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290754" xreflabel=""/>Maximum size of a <anchor xml:id="dbdoclet.50438256_marker-1290753" xreflabel=""/>file system</para></entry>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290756" xreflabel=""/>64 PB</para></entry>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290758" xreflabel=""/>Each OST or MDT can have a file system up to 16 TB, regardless of whether 32-bit or 64-bit kernels are on the server.</para><para><anchor xml:id="dbdoclet.50438256_pgfId-1290759" xreflabel=""/>You can have multiple OST file systems on a single OSS node.</para></entry>
              </row>
              <row>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290762" xreflabel=""/>Maximum <anchor xml:id="dbdoclet.50438256_marker-1290761" xreflabel=""/>file size</para></entry>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290764" xreflabel=""/>16 TB on 32-bit systems</para><para><anchor xml:id="dbdoclet.50438256_pgfId-1290765" xreflabel=""/> </para><para><anchor xml:id="dbdoclet.50438256_pgfId-1290766" xreflabel=""/>320 TB on 64-bit systems</para></entry>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290768" xreflabel=""/>Individual files have a hard limit of nearly 16 TB on 32-bit systems imposed by the kernel memory subsystem. On 64-bit systems this limit does not exist. Hence, files can be 64-bits in size. Lustre imposes an additional size limit of up to the number of stripes, where each stripe is 2 TB.</para><para><anchor xml:id="dbdoclet.50438256_pgfId-1294622" xreflabel=""/>A single file can have a maximum of 160 stripes, which gives an upper single file limit of 320 TB for 64-bit systems. The actual amount of data that can be stored in a file depends upon the amount of free space in each OST on which the file is striped.</para></entry>
              </row>
              <row>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290771" xreflabel=""/>Maximum number of <anchor xml:id="dbdoclet.50438256_marker-1290770" xreflabel=""/>files or subdirectories in a single directory</para></entry>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290773" xreflabel=""/>10 million files</para></entry>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290775" xreflabel=""/>Lustre uses the ldiskfs hashed directory code, which has a limit of about 10 million files depending on the length of the file name. The limit on subdirectories is the same as the limit on regular files.</para><para><anchor xml:id="dbdoclet.50438256_pgfId-1290776" xreflabel=""/>Lustre is tested with ten million files in a single directory.</para></entry>
              </row>
              <row>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290779" xreflabel=""/>Maximum number of files in the file system</para></entry>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290781" xreflabel=""/>4 billion</para></entry>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290783" xreflabel=""/>The ldiskfs file system imposes an upper limit of 4 billion inodes. By default, the MDS file system is formatted with 4 KB of space per inode, meaning 512 million inodes per file system of 2 TB.</para><para><anchor xml:id="dbdoclet.50438256_pgfId-1291983" xreflabel=""/>This can be increased initially, at the time of MDS file system creation. For more information, see <xref linkend='settinguplustresystem'/><link xl:href="SettingUpLustreSystem.html#50438256_84701">Setting File System Formatting Options</link>.</para></entry>
              </row>
              <row>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290792" xreflabel=""/>Maximum length of a <anchor xml:id="dbdoclet.50438256_marker-1290791" xreflabel=""/>filename</para></entry>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290794" xreflabel=""/>255 bytes (filename)</para></entry>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290798" xreflabel=""/>This limit is 255 bytes for a single filename, the same as in an ldiskfs file system.</para></entry>
              </row>
              <row>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1292013" xreflabel=""/>Maximum length of a <anchor xml:id="dbdoclet.50438256_marker-1292019" xreflabel=""/>pathname</para></entry>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1292015" xreflabel=""/>4096 bytes (pathname)</para></entry>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1292017" xreflabel=""/>The Linux VFS imposes a full pathname length of 4096 bytes.</para></entry>
              </row>
              <row>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290801" xreflabel=""/>Maximum number of <anchor xml:id="dbdoclet.50438256_marker-1290800" xreflabel=""/>open files for Lustre file systems</para></entry>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290803" xreflabel=""/>None</para></entry>
                <entry><para> <anchor xml:id="dbdoclet.50438256_pgfId-1290805" xreflabel=""/>Lustre does not impose a maximum for the number of open files, but the practical limit depends on the amount of RAM on the MDS. No &quot;tables&quot; for open files exist on the MDS, as they are only linked in a list to a given client&apos;s export. Each client process probably has a limit of several thousands of open files which depends on the ulimit.</para></entry>
              </row>
            </tbody>
          </tgroup>
        </table>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1290676" xreflabel=""/> </para>
      </section>
    </section>
    <section xml:id="dbdoclet.50438256_26456">
      <title>5.4 Determining Memory<anchor xml:id="dbdoclet.50438256_marker-1292212" xreflabel=""/> Requirements</title>
      <para><anchor xml:id="dbdoclet.50438256_pgfId-1292214" xreflabel=""/>This section describes the memory requirements for each Lustre file system component.</para>
      <section remap="h3">
        <title><anchor xml:id="dbdoclet.50438256_pgfId-1292221" xreflabel=""/>5.4.1 Client Memory Requirements</title>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1292222" xreflabel=""/>A minimum of 2 GB RAM is recommended for clients.</para>
      </section>
      <section remap="h3">
        <title><anchor xml:id="dbdoclet.50438256_pgfId-1292223" xreflabel=""/>5.4.2 <anchor xml:id="dbdoclet.50438256_78447" xreflabel=""/>MDS Memory Requirements</title>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1292225" xreflabel=""/>MDS memory requirements are determined by the following factors:</para>
        <itemizedlist><listitem>
            <para><anchor xml:id="dbdoclet.50438256_pgfId-1292226" xreflabel=""/> Number of clients</para>
          </listitem>
<listitem>
            <para><anchor xml:id="dbdoclet.50438256_pgfId-1292227" xreflabel=""/> Size of the directories</para>
          </listitem>
<listitem>
            <para><anchor xml:id="dbdoclet.50438256_pgfId-1292228" xreflabel=""/> Load placed on server</para>
          </listitem>
</itemizedlist>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1292229" xreflabel=""/>The amount of memory used by the MDS is a function of how many clients are on the system, and how many files they are using in their working set. This is driven, primarily, by the number of locks a client can hold at one time. The number of locks held by clients varies by load and memory availability on the server. Interactive clients can hold in excess of 10,000 locks at times. On the MDS, memory usage is approximately 2 KB per file, including the Lustre distributed lock manager (DLM) lock and kernel data structures for the files currently in use. Having file data in cache can improve metadata performance by a factor of 10x or more compared to reading it from disk.</para>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1292230" xreflabel=""/>MDS memory requirements include:</para>
        <itemizedlist><listitem>
            <para><anchor xml:id="dbdoclet.50438256_pgfId-1294632" xreflabel=""/><emphasis role="bold">File system metadata</emphasis> : A reasonable amount of RAM needs to be available for file system metadata. While no hard limit can be placed on the amount of file system metadata, if more RAM is available, then the disk I/O is needed less often to retrieve the metadata.</para>
          </listitem>
<listitem>
            <para><anchor xml:id="dbdoclet.50438256_pgfId-1294633" xreflabel=""/><emphasis role="bold">Network transport</emphasis> : If you are using TCP or other network transport that uses system memory for send/receive buffers, this memory requirement must also be taken into consideration.</para>
          </listitem>
<listitem>
            <para><anchor xml:id="dbdoclet.50438256_pgfId-1294399" xreflabel=""/><emphasis role="bold">Journal size</emphasis> : By default, the journal size is 400 MB for each Lustre ldiskfs file system. This can pin up to an equal amount of RAM on the MDS node per file system.</para>
          </listitem>
<listitem>
            <para><anchor xml:id="dbdoclet.50438256_pgfId-1292234" xreflabel=""/><emphasis role="bold">Failover configuration</emphasis> : If the MDS node will be used for failover from another node, then the RAM for each journal should be doubled, so the backup server can handle the additional load if the primary server fails.</para>
          </listitem>
</itemizedlist>
        <section remap="h4">
          <title><anchor xml:id="dbdoclet.50438256_pgfId-1292235" xreflabel=""/>5.4.2.1 Calculating MDS Memory Requirements</title>
          <para><anchor xml:id="dbdoclet.50438256_pgfId-1292236" xreflabel=""/>By default, 400 MB are used for the file system journal. Additional RAM is used for caching file data for the larger working set, which is not actively in use by clients but should be kept &quot;hot&quot; for improved access times. Approximately 1.5 KB per file is needed to keep a file in cache without a lock.</para>
          <para><anchor xml:id="dbdoclet.50438256_pgfId-1292237" xreflabel=""/>For example, for a single MDT on an MDS with 1,000 clients, 16 interactive nodes, and a 2 million file working set (of which 400,000 files are cached on the clients):</para>
          <para><anchor xml:id="dbdoclet.50438256_pgfId-1294457" xreflabel=""/>Operating system overhead = 512 MB</para>
          <para><anchor xml:id="dbdoclet.50438256_pgfId-1292238" xreflabel=""/>File system journal = 400 MB</para>
          <para><anchor xml:id="dbdoclet.50438256_pgfId-1292239" xreflabel=""/>1000 * 4-core clients * 100 files/core * 2kB = 800 MB</para>
          <para><anchor xml:id="dbdoclet.50438256_pgfId-1292240" xreflabel=""/>16 interactive clients * 10,000 files * 2kB = 320 MB</para>
          <para><anchor xml:id="dbdoclet.50438256_pgfId-1292241" xreflabel=""/>1,600,000 file extra working set * 1.5kB/file = 2400 MB</para>
          <para><anchor xml:id="dbdoclet.50438256_pgfId-1292242" xreflabel=""/>Thus, the minimum requirement for a system with this configuration is at least 4 GB of RAM. However, additional memory may significantly improve performance.</para>
          <para><anchor xml:id="dbdoclet.50438256_pgfId-1292243" xreflabel=""/>For directories containing 1 million or more files, more memory may provide a significant benefit. For example, in an environment where clients randomly access one of 10 million files, having extra memory for the cache significantly improves performance.</para>
        </section>
      </section>
      <section remap="h3">
        <title><anchor xml:id="dbdoclet.50438256_pgfId-1292246" xreflabel=""/>5.4.3 <anchor xml:id="dbdoclet.50438256_84553" xreflabel=""/>OSS Memory Requirements</title>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1292248" xreflabel=""/>When planning the hardware for an OSS node, consider the memory usage of several components in the Lustre system (i.e., journal, service threads, file system metadata, etc.). Also, consider the effect of the OSS read cache feature, which consumes memory as it caches data on the OSS node.</para>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1292249" xreflabel=""/>In addition to the MDS memory requirements mentioned in <xref linkend="dbdoclet.50438256_87676"/>, the OSS requirements include:</para>
        <itemizedlist><listitem>
            <para><anchor xml:id="dbdoclet.50438256_pgfId-1292250" xreflabel=""/><emphasis role="bold">Service threads</emphasis> : The service threads on the OSS node pre-allocate a 1 MB I/O buffer for each ost_io service thread, so these buffers do not need to be allocated and freed for each I/O request.</para>
          </listitem>
<listitem>
            <para><anchor xml:id="dbdoclet.50438256_pgfId-1292251" xreflabel=""/><emphasis role="bold">OSS read cache</emphasis> : OSS read cache provides read-only caching of data on an OSS, using the regular Linux page cache to store the data. Just like caching from a regular file system in Linux, OSS read cache uses as much physical memory as is available.</para>
          </listitem>
</itemizedlist>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1292252" xreflabel=""/>The same calculation applies to files accessed from the OSS as for the MDS, but the load is distributed over many more OSSs nodes, so the amount of memory required for locks, inode cache, etc. listed under MDS is spread out over the OSS nodes. as shown in 5.2.3.1.</para>
        <para><anchor xml:id="dbdoclet.50438256_pgfId-1292253" xreflabel=""/>Because of these memory requirements, the following calculations should be taken as determining the absolute minimum RAM required in an OSS node.</para>
        <section remap="h4">
          <title><anchor xml:id="dbdoclet.50438256_pgfId-1292254" xreflabel=""/>5.4.3.1 Calculating OSS Memory Requirements</title>
          <para><anchor xml:id="dbdoclet.50438256_pgfId-1292255" xreflabel=""/>The minimum recommended RAM size for an OSS with two OSTs is computed below:</para>
          <para><anchor xml:id="dbdoclet.50438256_pgfId-1292257" xreflabel=""/>Ethernet/TCP send/receive buffers (1 MB * 512 threads) = 512 MB</para>
          <para><anchor xml:id="dbdoclet.50438256_pgfId-1292258" xreflabel=""/>400 MB journal size * 2 OST devices = 800 MB</para>
          <para><anchor xml:id="dbdoclet.50438256_pgfId-1292259" xreflabel=""/>1.5 MB read/write per OST IO thread * 512 threads = 768 MB</para>
          <para><anchor xml:id="dbdoclet.50438256_pgfId-1292260" xreflabel=""/>600 MB file system read cache * 2 OSTs = 1200 MB</para>
          <para><anchor xml:id="dbdoclet.50438256_pgfId-1292262" xreflabel=""/>1000 * 4-core clients * 100 files/core * 2kB = 800MB</para>
          <para><anchor xml:id="dbdoclet.50438256_pgfId-1292263" xreflabel=""/>16 interactive clients * 10,000 files * 2kB = 320MB</para>
          <para><anchor xml:id="dbdoclet.50438256_pgfId-1292264" xreflabel=""/>1,600,000 file extra working set * 1.5kB/file = 2400MB</para>
          <para><anchor xml:id="dbdoclet.50438256_pgfId-1292265" xreflabel=""/> DLM locks + filesystem metadata TOTAL = 3520MB</para>
          <para><anchor xml:id="dbdoclet.50438256_pgfId-1292266" xreflabel=""/>Per OSS DLM locks + filesystem metadata = 3520MB/6 OSS = 600MB (approx.)</para>
          <para><anchor xml:id="dbdoclet.50438256_pgfId-1292267" xreflabel=""/>Per OSS RAM minimum requirement = 4096MB (approx.)</para>
          <para><anchor xml:id="dbdoclet.50438256_pgfId-1292268" xreflabel=""/>This consumes about 1,400 MB just for the pre-allocated buffers, and an additional 2 GB for minimal file system and kernel usage. Therefore, for a non-failover configuration, the minimum RAM would be 4 GB for an OSS node with two OSTs. Adding additional memory on the OSS will improve the performance of reading smaller, frequently-accessed files.</para>
          <para><anchor xml:id="dbdoclet.50438256_pgfId-1292269" xreflabel=""/>For a failover configuration, the minimum RAM would be at least 6 GB. For 4 OSTs on each OSS in a failover configuration 10GB of RAM is reasonable. When the OSS is not handling any failed-over OSTs the extra RAM will be used as a read cache.</para>
          <para><anchor xml:id="dbdoclet.50438256_pgfId-1292270" xreflabel=""/>As a reasonable rule of thumb, about 2 GB of base memory plus 1 GB per OST can be used. In failover configurations, about 2 GB per OST is needed.</para>
        </section>
      </section>
    </section>
    <section xml:id="dbdoclet.50438256_78272">
      <title>5.5 Implementing Networks To Be Used by Lustre</title>
      <para><anchor xml:id="dbdoclet.50438256_pgfId-1290491" xreflabel=""/>As a high performance file system, Lustre places heavy loads on networks. Thus, a network interface in each Lustre server and client is commonly dedicated to Lustre traffic. This is often a dedicated TCP/IP subnet, although other network hardware can also be used.</para>
      <para><anchor xml:id="dbdoclet.50438256_pgfId-1290944" xreflabel=""/>A typical Lustre implementation may include the following:</para>
      <itemizedlist><listitem>
          <para><anchor xml:id="dbdoclet.50438256_pgfId-1290945" xreflabel=""/> A high-performance backend network for the Lustre servers, typically an InfiniBand (IB) network.</para>
        </listitem>
<listitem>
          <para><anchor xml:id="dbdoclet.50438256_pgfId-1290946" xreflabel=""/> A larger client network.</para>
        </listitem>
<listitem>
          <para><anchor xml:id="dbdoclet.50438256_pgfId-1290947" xreflabel=""/> Lustre routers to connect the two networks.</para>
        </listitem>
</itemizedlist>
      <para><anchor xml:id="dbdoclet.50438256_pgfId-1291003" xreflabel=""/>Lustre networks and routing are configured and managed by specifying parameters to the Lustre Networking (lnet) module in /etc/modprobe.conf or /etc/modprobe.conf.local (depending on your Linux distribution).</para>
      <para><anchor xml:id="dbdoclet.50438256_pgfId-1290498" xreflabel=""/>To prepare to configure Lustre Networking, complete the following steps:</para>
      <orderedlist>
          <listitem>
      <para><anchor xml:id="dbdoclet.50438256_pgfId-1290499" xreflabel=""/> 1. Identify all machines that will be running Lustre and the network interfaces they will use to run Lustre traffic. These machines will form the Lustre network.</para>
      <para><anchor xml:id="dbdoclet.50438256_pgfId-1290500" xreflabel=""/>A network is a group of nodes that communicate directly with one another. Lustre includes Lustre network drivers (LNDs) to support a variety of network types and hardware (see <xref linkend='understandinglustrenetworking'/> for a complete list). The standard rules for specifying networks applies to Lustre networks. For example, two TCP networks on two different subnets (tcp0 and tcp1) are considered to be two different Lustre networks.</para>
  </listitem>
          <listitem>
      <para><anchor xml:id="dbdoclet.50438256_pgfId-1290501" xreflabel=""/> 2. If routing is needed, identify the nodes to be used to route traffic between networks.</para>
      <para><anchor xml:id="dbdoclet.50438256_pgfId-1291115" xreflabel=""/>If you are using multiple network types, then youâ€™ll need a router. Any node with appropriate interfaces can route Lustre Networking (LNET) traffic between different network hardware types or topologies --the node may be a server, a client, or a standalone router. LNET can route messages between different network types (such as TCP-to-InfiniBand) or across different topologies (such as bridging two InfiniBand or TCP/IP networks). Routing will be configured in <xref linkend='configuringlnet'/>.</para>
  </listitem>
          <listitem>
      <para><anchor xml:id="dbdoclet.50438256_pgfId-1290503" xreflabel=""/> 3. Identify the network interfaces to include in or exclude from LNET.</para>
      <para><anchor xml:id="dbdoclet.50438256_pgfId-1290504" xreflabel=""/>If not explicitly specified, LNET uses either the first available interface or a pre-defined default for a given network type. Interfaces that LNET should not use (such as an administrative network or IP-over-IB), can be excluded.</para>
      <para><anchor xml:id="dbdoclet.50438256_pgfId-1291053" xreflabel=""/>Network interfaces to be used or excluded will be specified using the lnet kernel module parameters networks and ip2netsas described in <xref linkend='configuringlnet'/>.</para>
  </listitem>
          <listitem>
      <para><anchor xml:id="dbdoclet.50438256_pgfId-1290505" xreflabel=""/> 4. To ease the setup of networks with complex network configurations, determine a cluster-wide module configuration.</para>
      <para><anchor xml:id="dbdoclet.50438256_pgfId-1290506" xreflabel=""/>For large clusters, you can configure the networking setup for all nodes by using a single, unified set of parameters in the modprobe.conf file on each node. Cluster-wide configuration is described in <xref linkend='configuringlnet'/>.</para>
  </listitem>
      </orderedlist>

      <note>
      <para><anchor xml:id="dbdoclet.50438256_pgfId-1291030" xreflabel=""/>We recommend that you use â€œdotted-quadâ€ notation for IP addresses rather than host names to make it easier to read debug logs and debug configurations with multiple interfaces.</para>
  </note>
      
    </section>
</chapter>
